## CSRF攻击
### 什么是CSRF

CSRF（Cross-site request forgery），中文名称：跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF

那么CSRF到底能够干嘛呢？你可以这样简单的理解：攻击者可以盗用你的登陆信息，以你的身份模拟发送各种请求。

所以遇到CSRF攻击时，将对终端用户的数据和操作指令构成严重的威胁；当受攻击的终端用户具有管理员帐户的时候，CSRF攻击将危及整个Web应用程序。

### CSRF的原理

![](https://github.com/Yangliangfeng/GO/raw/master/images/11.jpg)

从上图可以看出，要完成一次CSRF攻击，受害者必须依次完成两个步骤 ：
  * 1.登录受信任网站A，并在本地生成Cookie 
  * 2.在不退出A的情况下，访问危险网站B

### 预防CSRF

服务端的预防CSRF攻击的方式方法有多种，但思想上都是差不多的，主要从以下2个方面入手：
  * 1.正确使用GET,POST和Cookie
  * 2.在非GET请求中增加伪随机数

因此，一般都是按照如下方式设计应用：
  * 1.GET常用在查看，列举，展示等不需要改变资源属性的时候
  * 2.POST常用在下达订单，改变一个资源的属性或者做其他一些事情

这样处理后，因为我们限定了修改只能使用POST，当GET方式请求时就拒绝响应，所以上面图示中GET方式的CSRF攻击就可以防止了，但这样就能全部解决问题了吗？当然不是，因为POST也是可以模拟的。

因此我们需要实施第二步，在非GET方式的请求中增加随机数，这个大概有三种方式来进行：
  * 1.为每个用户生成一个唯一的cookie token，所有表单都包含同一个伪随机值，这种方案最简单，因为攻击者不能获得第三方的Cookie(理论上)，所以表单中的数据也就构造失败，但是由于用户的Cookie很容易由于网站的XSS漏洞而被盗取，所以这个方案必须要在没有XSS的情况下才安全。
  * 2.每个请求使用验证码，这个方案是完美的，因为要多次输入验证码，所以用户友好性很差，所以不适合实际运用
  * 3.不同的表单包含一个不同的伪随机值(就是每个表单随机生成token，然后在表单提交的时候，比对表单提交过来的token)，这种方式是比较安全且使用比较频繁的。
